/*! Ideal Postcodes jQuery Plugin - v2.1.1 - 2014-10-15
* https://github.com/ideal-postcodes/jquery.postcodes
* Copyright (c) 2014 Ideal Postcodes; Licensed MIT */
!function(a){"use strict";function b(b){this.config={},a.extend(this,d),b&&a.extend(this,b);var c={};for(var e in this.output_fields)void 0!==this.output_fields[e]&&(c[e]=a(this.output_fields[e]));this.$output_fields=c}var c=[],d={api_key:"",output_fields:{line_1:"#line_1",line_2:"#line_2",line_3:"#line_3",post_town:"#post_town",postcode:"#postcode",postcode_inward:void 0,postcode_outward:void 0,udprn:void 0,dependant_locality:void 0,double_dependant_locality:void 0,thoroughfare:void 0,dependant_thoroughfare:void 0,building_number:void 0,building_name:void 0,sub_building_name:void 0,po_box:void 0,department_name:void 0,organisation_name:void 0,postcode_type:void 0,su_organisation_indicator:void 0,delivery_point_suffix:void 0},api_endpoint:"https://api.ideal-postcodes.co.uk/v1",input:void 0,$input:void 0,input_label:"Enter postcode",input_muted_style:"color:#CBCBCB;",input_class:"form-control form-control-1-4 postcode-field",input_id:"idpc_input",button:void 0,$button:void 0,button_id:"idpc_button",button_label:"Find Address",button_class:"button carriage-return",button_disabled_message:"Looking up postcode...",$dropdown:void 0,dropdown_id:"idpc_dropdown",dropdown_select_message:"Please select your address",dropdown_class:"",$error_message:void 0,error_message_id:"idpc_error_message",error_message_invalid_postcode:"Please check your postcode, it seems to be incorrect",error_message_not_found:"Your postcode could not be found. Please type in your address",error_message_default:"Sorry, we weren't able to get the address you were looking for. Please type your address manually",error_message_class:"",last_lookup:"",disable_interval:1e3,debug_mode:!1,check_key:!1,remove_organisation:!1,onLoaded:void 0,onFailedCheck:void 0,onLookupSuccess:void 0,onLookupError:void 0,onAddressSelected:void 0};b.prototype.setupPostcodeInput=function(a){this.$context=a,this.setupInputField(),this.setupLookupButton()},b.prototype.setupInputField=function(){var b=this;return this.$input=a(this.input).length?a(this.input).first():a("<input />",{type:"text",id:this.input_id,value:this.input_label}).appendTo(this.$context).addClass(this.input_class).val(this.input_label).attr("style",this.input_muted_style).submit(function(){return!1}).keypress(function(a){13===a.which&&b.$button.trigger("click")}).focus(function(){b.$input.removeAttr("style").val("")}).blur(function(){b.$input.val()||(b.$input.val(b.input_label),b.$input.attr("style",b.input_muted_style))}),this.$input},b.prototype.setupLookupButton=function(){var b=this;return this.$button=a(this.button).length?a(this.button).first():a("<button />",{html:this.button_label,id:this.button_id,type:"button"}).appendTo(this.$context).addClass(this.button_class).attr("onclick","return false;").submit(function(){return!1}),this.$button.click(function(){var a=b.$input.val();return b.last_lookup!==a&&(b.last_lookup=a,b.clearAll(),b.disableLookup(),b.lookupPostcode(a)),!1}),this.$button},b.prototype.disableLookup=function(a){this.button||(a=a||this.button_disabled_message,this.$button.prop("disabled",!0).html(a))},b.prototype.enableLookup=function(){if(!this.button){var a=this;0===a.disable_interval?a.$button.prop("disabled",!1).html(a.button_label):setTimeout(function(){a.$button.prop("disabled",!1).html(a.button_label)},a.disable_interval)}},b.prototype.clearAll=function(){this.setDropDown(),this.setErrorMessage()},b.prototype.removeAll=function(){this.$context=null,a.each([this.$input,this.$button,this.$dropdown,this.$error_message],function(a,b){b&&b.remove()})},b.prototype.lookupPostcode=function(b){var c=this;return a.idealPostcodes.validatePostcodeFormat(b)?void a.idealPostcodes.lookupPostcode(b,c.api_key,function(a){c.response_code=a.code,c.response_message=a.message,c.result=a.result,c.enableLookup(),2e3===c.response_code?(c.last_lookup=b,c.setDropDown(c.result)):c.setErrorMessage(4040===c.response_code?c.error_message_not_found:c.debug_mode?"("+c.response_code+") "+c.response_message:c.error_message_default),c.onLookupSuccess&&c.onLookupSuccess.call(c,a)},function(){c.setErrorMessage("Unable to connect to server"),c.enableLookup(),c.onLookupError&&c.onLookupError.call(c)}):(this.enableLookup(),c.setErrorMessage(this.error_message_invalid_postcode))},b.prototype.setDropDown=function(b){var c=this;if(this.$dropdown&&this.$dropdown.length&&(this.$dropdown.remove(),delete this.$dropdown),b){var d=a("<select />",{id:c.dropdown_id}).addClass(c.dropdown_class);a("<option />",{value:"ideal",text:c.dropdown_select_message}).appendTo(d);for(var f=b.length,g=0;f>g;g+=1)a("<option />",{value:g,text:b[g].line_1+" "+b[g].line_2}).appendTo(d);return d.appendTo(c.$context).change(function(){var d,f=a(this).val();f>=0&&(d=c.remove_organisation?e(b[f]):b[f],c.setAddressFields(d),c.onAddressSelected&&c.onAddressSelected.call(c,d))}),c.$dropdown=d,d}},b.prototype.setErrorMessage=function(b){return this.$error_message&&this.$error_message.length&&(this.$error_message.remove(),delete this.$error_message),b?(this.$error_message=a("<p />",{html:b,id:this.error_message_id}).addClass(this.error_message_class).appendTo(this.$context),this.$error_message):void 0},b.prototype.setAddressFields=function(a){a=a||{};for(var b in this.$output_fields)this.$output_fields[b].val(a[b]||"")};var e=function(a){return 0!==a.organisation_name.length&&a.line_1===a.organisation_name&&(a.line_1=a.line_2,a.line_2=a.line_3,a.line_3=""),a};a.idealPostcodes={defaults:function(){return d},validatePostcodeFormat:function(a){return!!a.match(/^[a-zA-Z0-9]{1,4}\s?\d[a-zA-Z]{2}$/)||!!a.match(/^id1/i)},lookupPostcode:function(b,c,e,f){var g=d.api_endpoint,h="postcodes",i=[g,h,b].join("/"),j={url:i,data:{api_key:c},dataType:"jsonp",timeout:5e3,success:e};f&&(j.error=f),a.ajax(j)},checkKey:function(b,c,e){var f=d.api_endpoint,g="keys",h=[f,g,b].join("/"),i={url:h,dataType:"jsonp",timeout:5e3,success:function(a){a.result.available?c():e&&e()}};e&&(i.error=e),a.ajax(i)},clearAll:function(){for(var a=c.length,b=0;a>b;b+=1)c[b].removeAll()}},a.fn.setupPostcodeLookup=function(d){var e=this,f=function(){var f=new b(d);c.push(f),f.setupPostcodeInput(a(e)),a.isFunction(d.onLoaded)&&d.onLoaded.call(e)};return d.check_key?a.idealPostcodes.checkKey(d.api_key,f,function(){a.isFunction(d.onFailedCheck)&&d.onFailedCheck.call(e)}):f(),e}}(jQuery);